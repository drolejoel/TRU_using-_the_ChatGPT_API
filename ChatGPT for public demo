# hit the ChatGPT API with code generated by ChatGPT

# path to ChatGPT TOKEN
path <- "C:/Users/MY_NAME/Documents/R/CODE/ChatGPT AI/SECRET - ChatGPT API token"

# ---------------- function ChatGPT

library(tidyverse)
library(httr)
library(listviewer)

chatgpt_api <- function(text){
  endpoint <- "https://api.openai.com/v1/engines/davinci/completions"
  body <- list(prompt=text, max_tokens=100)
  response <- POST(endpoint, 
                   body=body, 
                   add_headers(Authorization = paste("Bearer", readLines(path))),
                   encode="json")
  return(content(response))
}
# debug(chatgpt_api)
prompt_text <- "write me a job description for an IT manager"
prompt_text <- "what is blue?"
prompt_text <- "using the mtcars dataset, write a function in the R programming language to show me all cars which have 6 cylinders"

res <- chatgpt_api(prompt_text)
res
str(res)
res %>% jsonedit()

pluck(res, "choices", 1, 1)
pluck(res, "choices", 1, "text")



# ======================== my working version using Stackoverflow

# ----------------- correct answer from StackOverflow
# httr::BROWSE("https://stackoverflow.com/questions/67372903/access-openai-json-api-from-r")
myurl <- "https://api.openai.com/v1/engines/davinci/completions"
# apikey <- api_key
prompt_text <- "what is a magic mushroom?"
tokens <- 100
output <- POST(myurl, 
               body = list(prompt = prompt_text, max_tokens = tokens), 
               add_headers(Authorization = paste("Bearer", api_key)), 
               encode = "json")
content(output)$choices[[1]]$text
